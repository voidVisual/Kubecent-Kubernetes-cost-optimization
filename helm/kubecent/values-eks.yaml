# AWS EKS Production Values for KubeCent
# This file contains optimized settings for AWS EKS deployment

# Replica count for high availability
replicaCount: 2

# Docker images - Update these with your ECR repository URLs
image:
  backend:
    # Replace YOUR_AWS_ACCOUNT_ID and AWS_REGION with actual values
    repository: YOUR_AWS_ACCOUNT_ID.dkr.ecr.AWS_REGION.amazonaws.com/kubecent-backend
    tag: v1.0.0
    pullPolicy: IfNotPresent
  
  frontend:
    # Replace YOUR_AWS_ACCOUNT_ID and AWS_REGION with actual values
    repository: YOUR_AWS_ACCOUNT_ID.dkr.ecr.AWS_REGION.amazonaws.com/kubecent-frontend
    tag: v1.0.0
    pullPolicy: IfNotPresent

# Service configuration - LoadBalancer for AWS ELB
service:
  type: LoadBalancer
  backend:
    port: 8000
    targetPort: 8000
    # Annotations for AWS Load Balancer
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"  # Network Load Balancer
      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
  
  frontend:
    port: 80
    targetPort: 80
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"

# Ingress configuration (optional - for custom domain with SSL)
ingress:
  enabled: false  # Set to true if using AWS Load Balancer Controller
  className: "alb"
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    # Uncomment and add your ACM certificate ARN for HTTPS
    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:region:account-id:certificate/certificate-id
  hosts:
    - host: kubecent.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # Uncomment for HTTPS
    # - secretName: kubecent-tls
    #   hosts:
    #     - kubecent.yourdomain.com

# Resource limits for EKS (optimized for production)
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

# Horizontal Pod Autoscaling
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Node selector for specific instance types (optional)
nodeSelector: {}
  # Example: Run on specific node group
  # node.kubernetes.io/instance-type: t3.medium

# Tolerations (optional)
tolerations: []
  # Example: Tolerate specific taints
  # - key: "dedicated"
  #   operator: "Equal"
  #   value: "kubecent"
  #   effect: "NoSchedule"

# Pod affinity/anti-affinity
affinity:
  # Spread pods across different availability zones
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - kubecent
          topologyKey: topology.kubernetes.io/zone

# OpenCost configuration - points to actual OpenCost in your cluster
opencost:
  enabled: true
  url: "http://opencost.opencost.svc.cluster.local:9003"

# Prometheus configuration - points to actual Prometheus in your cluster
prometheus:
  url: "http://prometheus-server.monitoring.svc.cluster.local:9090"
  scrapeInterval: 15s

# RBAC - Required for Kubernetes API access
rbac:
  create: true
  serviceAccountName: kubecent

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  # Additional security settings for AWS
  seccompProfile:
    type: RuntimeDefault
  capabilities:
    drop:
      - ALL

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Cache TTL in seconds
cacheTTL: 300

# Debug mode (disable in production)
debug: false

# Environment
environment: production

# Health check configuration
healthCheck:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Readiness probe configuration
readinessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# Pod disruption budget for high availability
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Monitoring and observability
monitoring:
  enabled: true
  prometheus:
    enabled: true
    port: 8000
    path: /metrics

# AWS-specific settings
aws:
  # Region where your EKS cluster is running
  region: us-east-1
  
  # EKS cluster name
  clusterName: your-eks-cluster
  
  # Enable AWS IAM roles for service accounts (IRSA) if needed
  irsa:
    enabled: false
    # roleArn: arn:aws:iam::ACCOUNT_ID:role/kubecent-role

# Backup and persistence (optional)
persistence:
  enabled: false
  # If you need persistent storage for cache or logs
  # storageClass: gp3
  # size: 10Gi

# Additional environment variables
extraEnv: []
  # - name: CUSTOM_VAR
  #   value: "custom_value"

# Additional labels for all resources
commonLabels: {}
  # environment: production
  # team: platform

# Additional annotations for all resources
commonAnnotations: {}
  # managed-by: helm
